# API

### 1. Авторизация
#### Запрос
###### Путь
**POST** /sign-in
###### Тело
```json
{
	"login": "example",
	"password": "example"
}
```
#### Ответ
###### Тело
**200 OK**
```json
{
	"jwt": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c"
}
```
**400 Ошибка валидации**
```json
{
	"message": "Wrong user email format"
}
```
**404 Неправильная пара логин/пароль**
```json
{
	"message": "User with such email and password does not exist"
}
```
### 2. Регистрация
#### Запрос
###### Путь
**POST** /sign-up
###### Тело
```json
{
	"login": "example",
	"email": "example@mail.ru",
	"password": "example",
	"name": "John Doe",
	"dateOfBirth": "07.07.2007",
	"gender": "MALE"
}
```
#### Ответ
###### Тело
**200 OK**
```json
{ */void/*}
```
**400 Ошибка валидации**
```json
{
	"message": "Wrong user email format"
}
```
**409 Пользователь с данным логином уже существует**
```json
{
	"message": "Error text"
}
```
**412 Пользователь с данной почтой уже существует**
```json
{
	"message": "Error text"
}
```
### 3. Подтверждение почты
#### Запрос
###### Путь
**POST** /confirm?token=*{token_value}*<br>
На почту пользователю отправляем ссылку формата http://hostname:port/confirm?token={token_value}. Android приложение данную ссылку перехватывает (Deeplink) и затем отправляет POST-запрос на сервер по тому же URL с теми же queryParams.
#### Ответ
###### Тело
**200 OK**
```json
{ */void/*}
```
**400 Ошибка валидации токена**
Для безопасности не пишем является ли токен валидным, но истекшим, либо просто невалидным.
```json
{
	"message": "Invalid token"
}
```
### 4. Получение карточки профиля пользователя
#### Запрос
###### Путь
**GET** /user/{userId}/card<br>
Аватарку пользователя получаем по URL http://hostname:port/user/{userId}/picture.<br>
Аватаркой пользователя считается последняя добавленная фотография.<br>
#### Ответ
###### Тело
**200 OK**
```json
{
	"id": "USER_ID",
	"age": 18,
	"name": "John Doe",
	"status": "Трудно найти, легко найти..."  | null,
	"gender": "MALE"
}
```
**404 Пользователь с таким id не существует**
```json
{
	"message": "Error text"
}
```
### 5. Получение профиля пользователя
#### Запрос
###### Путь
**GET** /user/{userId}<br>
Фотографии пользователя получаем по URL http://hostname:port/user/{userId}/pictures.<br>
**ИЛИ**<br>
Фотографии пользователя получаем лениво (по необходимости) по URL http://hostname:port/user/{userId}/pictures/{pictureId}<br>
*pictureId* - порядковый номер текущей фотографиии
#### Ответ
###### Тело
**200 OK**
```json
{
	"id": "USER_ID",
	"age": 18,
	"name": "John Doe",
	"status": "Трудно найти, легко найти..."  | null,
	"bio": "ABOUT ME"  | null,
	"gender": "MALE",
	"isLiked": false,
	"picturesCount": 7 // в случае использования ленивой загрузки фотографий
}
```
**404 Пользователь с таким id не существует**
```json
{
	"message": "Error text"
}
```
### 6. Лайкнуть/дизлайкнуть пользователя
#### Запрос
###### Путь
**POST** /user/{userId}/like<br>
Повторный лайк == дизлайк (снятие лайка)
#### Ответ
###### Тело
**200 OK**
```json
{/*void*/}
```
**404 Пользователь с таким id не существует**
```json
{
	"message": "Error text"
}
```
### 7. Базовое редактирование профиля
#### Запрос
###### Путь
**PUT** /user/edit<br>
При смене логина указываем новое значение поля *login*, при изменении информации о себе поле *bio*  и т.п.<br>
Минимум одно из полей запроса должно быть не null.<br>
###### Тело
```json
{
	"login": "example" | null,
	"name": "John Doe" | null,
	"dateOfBirth": "07.07.2007" | null,
	"bio": "ABOUT ME" | null,
	"status": "Трудно найти, легко найти..." | null
}
```
#### Ответ
###### Тело
**200 OK**
```json
{/*void*/}
```
**400 Ошибка валидации**
```json
{
	"message": "Error text"
}
```
**409 Пользователь с данным логином уже существует**
```json
{
	"message": "Error text"
}
```
### 8. Смена пароля
Юзкейс состоит из двух пар запросов/ответов.
#### Запрос 1
###### Путь
**POST** /user/check-password<br>
Для того, чтобы сменить пароль пользователю сначала необходимо ввести старый пароль.<br>
*password*  - текущий пароль пользователя. Если введеное пользвотелем значение совпало с его текущим паролем, то сервер присылает ответ с кодом 200 и токеном *token*, подписанным сервером (тут можно просто сгенерить jwt с подписью сервера), который подтверждает, что пользователь корректно ввел текущий пароль.
###### Тело
```json
{
	"password": "example"
}
```
#### Ответ 1
###### Тело
**200 OK**
```json
{
	"token": "c447e9e0-2c22-4869-866d-806904fdab27"
}
```
**400 Неверный пароль**
```json
{
	"message": "Error text"
}
```
#### Запрос 2
###### Путь
**POST** /user/edit/password<br>
*password*  - новый пароль пользователя. *token* - токен из предыдущего шага.
###### Тело
```json
{
	"password": "example",
	"token": "c447e9e0-2c22-4869-866d-806904fdab27"
}
```
#### Ответ 2
###### Тело
**200 OK**
```json
{/*void*/}
```
**400 Невалидный пароль**
```json
{
	"message": "Error text"
}
```
**404 Невалидный токен**
```json
{
	"message": "Error text"
}
```
### 9. Смена почты
#### Запрос
###### Путь
**PUT** /user/edit/email<br>
*email* - новая почта пользователя. При обработке данного запроса сервер не меняет почту пользователя сразу. На новую почту отправляется письмо с ссылкой для подтверждения почты, и только после этого действия почта пользователя обновляется
###### Тело
```json
{
	"email": "example@gmail.com"
}
```
#### Ответ
###### Тело
**200 OK**
```json
{/*void*/}
```
**400 Ошибка валидации**
```json
{
	"message": "Error text"
}
```
**409 Пользователь с данной почтой уже существует**
```json
{
	"message": "Error text"
}
```
### 10. Подтверждение новой почты
#### Запрос
###### Путь
**POST** /confirm-new-email?token=*{token_value}*<br>
На почту пользователю отправляем ссылку формата http://hostname:port/confirm-new-email?token={token_value}. Android приложение данную ссылку перехватывает (Deeplink) и затем отправляет POST-запрос на сервер по тому же URL с теми же queryParams.
#### Ответ
###### Тело
**200 OK**
```json
{ */void/*}
```
**400 Ошибка валидации токена**
Для безопасности не пишем является ли токен валидным, но истекшим, либо просто невалидным.
```json
{
	"message": "Invalid token"
}
```
